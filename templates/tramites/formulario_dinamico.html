{% load tramites_extras %}

<div class="card-custom mb-4" style="border: 1px solid var(--color-border-light); box-shadow: var(--shadow-sm);">
    <div class="card-header-custom" style="background: var(--color-background-light); border-bottom: 1px solid var(--color-border-light); padding: var(--spacing-md) var(--spacing-lg);">
        <h5 class="mb-0" style="font-size: var(--font-size-lg); color: var(--color-primary); font-weight: var(--font-weight-semibold);">
            <i class="fas fa-file-alt me-2" style="font-size: var(--font-size-base); opacity: 0.7;"></i>
            Gestión de Documentos: {{ plantilla.nombre }}
        </h5>
    </div>
    <div class="card-body-custom" style="padding: var(--spacing-lg);">

        <div class="alert-custom alert-custom-info mb-4">
            <i class="fas fa-info-circle"></i>
            <span>Para iniciar este trámite, por favor descargue la plantilla, complétela y súbala nuevamente.</span>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-xl);">
            <!-- Columna Izquierda: Descargar Plantilla -->
            <div style="background-color: var(--color-bg-secondary); padding: var(--spacing-lg); border-radius: var(--border-radius-md); border: 1px solid var(--color-border);">
                <h5 style="font-size: var(--font-size-md); margin-bottom: var(--spacing-sm); color: var(--color-text-primary);">
                    <i class="fas fa-download" style="color: var(--color-primary); margin-right: var(--spacing-sm);"></i>
                    1. Descargar Plantilla
                </h5>
                <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-md);">
                    Obtenga el documento maestro PDF para llenarlo con sus datos.
                </p>

                {% if plantilla.archivo_base %}
                    <a href="{{ plantilla.archivo_base.url }}" download class="btn-custom btn-secondary" style="width: 100%; text-align: center; justify-content: center;">
                        <i class="fas fa-file-pdf"></i> Descargar PDF Maestro
                    </a>
                {% else %}
                    <div class="alert-custom alert-custom-warning" style="margin-bottom: 0;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>No hay plantilla disponible.</span>
                    </div>
                {% endif %}
            </div>

            <!-- Columna Derecha: Iniciar Trámite (Subir Documento) -->
            <div style="background-color: var(--color-bg-secondary); padding: var(--spacing-lg); border-radius: var(--border-radius-md); border: 1px solid var(--color-border);">
                <h5 style="font-size: var(--font-size-md); margin-bottom: var(--spacing-sm); color: var(--color-text-primary);">
                    <i class="fas fa-upload" style="color: var(--color-primary); margin-right: var(--spacing-sm);"></i>
                    2. Subir Plantilla Llenada
                </h5>
                <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-md);">
                    Suba el PDF completado para iniciar el trámite.
                </p>

                <form method="post" action="{% url 'tramites:iniciar_tramite' plantilla.id %}" enctype="multipart/form-data">
                    {% csrf_token %}

                    <!-- Primer archivo -->
                    <div style="margin-bottom: var(--spacing-md);">
                        <label for="archivo_inicio" style="display: block; margin-bottom: var(--spacing-xs); color: var(--color-text-primary); font-weight: var(--font-weight-medium);">
                            Documento 1:
                        </label>
                        <input type="file" name="archivo" id="archivo_inicio" class="form-control-file" accept="application/pdf" style="width: 100%;">
                        <small style="color: var(--color-text-muted); display: block; margin-top: var(--spacing-xs);">
                            Formato PDF. Máx 10MB.
                        </small>
                    </div>

                    <!-- Segundo archivo (opcional) -->
                    <div style="margin-bottom: var(--spacing-md);">
                        <label for="archivo_inicio2" style="display: block; margin-bottom: var(--spacing-xs); color: var(--color-text-primary); font-weight: var(--font-weight-medium);">
                            Documento 2 :
                        </label>
                        <input type="file" name="archivo_2" id="archivo_inicio2" class="form-control-file" accept="application/pdf" style="width: 100%;">
                        <small style="color: var(--color-text-muted); display: block; margin-top: var(--spacing-xs);">
                            Formato PDF. Máx 10MB.
                        </small>
                    </div>

                    <button type="submit" class="btn-custom btn-primary" style="width: 100%; justify-content: center;">
                        <i class="fas fa-paper-plane"></i> Iniciar Trámite
                    </button>
                </form>
            </div>
        </div>

    </div>
</div>
